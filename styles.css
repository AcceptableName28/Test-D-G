:root{
  --bg:#0f1216;
  --panel:#171b21;
  --panel-2:#1f252e;
  --text:#e6edf3;
  --muted:#9aa7b3;
  --primary:#18a45b;
  --accent:#0ea5e9;

  --cut:#ff005d;        /* M100 spot-ish */
  --crease:#00a0ff;     /* C100 */
  --perf:#ffc400;       /* Y100 */
  --bleed:#f25;
  --guide:#9a9a9a;
}

*{box-sizing:border-box}
html,body{height:100%; background:var(--bg); color:var(--text); font:14px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"}
button,input,select{color:var(--text); background:var(--panel); border:1px solid #2b3440; padding:.5rem .65rem; border-radius:8px}
select{appearance:none}
button{cursor:pointer}
button.primary{background:var(--primary); border-color:transparent; color:#05170d}
button.accent{background:var(--accent); border-color:transparent; color:#03121a}
button:hover{filter:brightness(1.06)}
button:active{transform:translateY(1px)}
label{display:block; margin-bottom:.25rem; color:var(--muted)}
input[type="number"]{width:100%}
section{margin-bottom:1rem}
.two{display:grid; grid-template-columns:1fr 1fr; gap:.75rem}
code{background:#0b0d10; padding:2px 6px; border-radius:4px}
.subnote{color:var(--muted); font-size:.85rem; margin-top:.35rem}

.app-header{
  display:flex; align-items:center; justify-content:space-between;
  padding:.6rem 1rem; background:var(--panel-2); border-bottom:1px solid #2b3440; position:sticky; top:0; z-index:6
}
.brand{font-weight:700; letter-spacing:.3px}
.toolbar{display:flex; gap:.4rem; align-items:center}
.toolbar .sep{display:inline-block; width:1px; height:22px; background:#2b3440; margin:0 .35rem}
.tog{display:inline-flex; align-items:center; gap:.35rem; font-size:.9rem}
.tog input{transform:translateY(1px)}

.app{display:grid; grid-template-columns:320px 1fr; min-height:calc(100vh - 84px)}
.sidebar{background:var(--panel); border-right:1px solid #2b3440; padding:1rem .9rem; overflow:auto}
.sidebar #templateSearch{width:100%; margin-top:.5rem}
.legend{display:grid; grid-template-columns:1fr 1fr; gap:.4rem; margin-top:.5rem}
.legend .swatch{display:inline-block; width:12px; height:12px; border-radius:999px; margin-right:.35rem; vertical-align:middle}
.legend .cut{background:var(--cut)}
.legend .crease{background:var(--crease)}
.legend .perf{background:var(--perf)}
.legend .bleed{background:var(--bleed)}
.legend .guide{background:var(--guide)}

.stage-wrap{position:relative; overflow:auto}
.stage{
  width:100%; height:calc(100vh - 140px);
  display:grid; place-items:center; background:#0b0d10
}
#viewer{
  width:min(1400px, 96vw);
  height:min(78vh, 900px);
  outline:none; touch-action:none; background:#fff; border-radius:10px;
  box-shadow:0 0 0 1px #2b3440, 0 10px 30px rgba(0,0,0,.4);
}

.preflight{
  position:absolute; right:12px; bottom:12px; max-width:420px;
  background:rgba(20,24,31,.9); border:1px solid #2b3440; padding:.8rem .9rem; border-radius:10px;
  backdrop-filter: blur(4px); color:#f6d6a7; font-size:.92rem; line-height:1.25; display:none;
}
.preflight.ok{color:#9fe3b3}
.preflight ul{margin:.35rem 0 0 1rem}

.app-footer{
  display:flex; align-items:center; justify-content:space-between;
  gap:1rem; padding:.45rem .9rem; border-top:1px solid #2b3440; background:var(--panel-2)
}

#status{color:var(--muted)}
#zoomDisplay{color:var(--muted)}

/* Handle dots for node editing */
.handle{
  fill:#fff; stroke:#0ea5e9; stroke-width:2; cursor:grab;
  filter:drop-shadow(0 0 2px rgba(0,0,0,.6))
}
.handle:active{cursor:grabbing}

/* dashed visuals */
.cut   path{stroke:var(--cut)}
.score path{stroke:var(--crease)}
.perf  path{stroke:var(--perf)}
#bleedLayer path{stroke:var(--bleed); stroke-dasharray:6 6}
#guidesLayer path,#gridLayer path{stroke:var(--guide)}
#dimsLayer text{fill:#0f5132}

/* mobile tweaks */
@media (max-width: 980px){
  .app{grid-template-columns:1fr}
  .sidebar{order:2}
  .stage-wrap{order:1}
  #viewer{width:98vw; height:70vh}
}